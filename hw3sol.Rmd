---
title: "Solutions"
output: github_document
date: "2024-10-05"
---
```{R}
library(readxl)
library(tidyverse)
library(ggplot2)
```

```{R}
#Q2
covar= read_csv("nhanes_covar.csv", skip = 4) |>
  janitor::clean_names() |>
  mutate(age = as.integer(age)) |>
  mutate(sex = case_when(
    sex == 1 ~ "male",
    sex == 2 ~ "female"
  )) |>
  mutate(education = case_when(
    education == 1 ~ "<HS",
    education == 2 ~ "=HS",
    education == 3 ~ ">HS"
  )) |>
  filter(age>20) |>
  drop_na(sex, age)
covar
sex_edu_covar = covar |>
  group_by(sex, education) |>
  summarize(total = n())
sex_edu_covar
ggplot(covar, aes(x = age, fill = sex)) +
  geom_histogram(binwidth = 5, position = "dodge") +
  facet_wrap(~ education) +
  labs(title = "Age Distribution by Gender and Education Level",
       x = "Age",
       y = "Count")


accel = read_csv("nhanes_accel.csv") |>
  janitor::clean_names()
accel
covar_accel = merge(covar, accel, by = "seqn", all =TRUE) |>
  drop_na(sex, age)
covar_accel
```



```{R}
#Q3 citibike
jan20 = read_csv("Jan2020Citi.csv") |>
  janitor::clean_names() |>
  mutate(time = "Jan 2020")
jan24 = read_csv("Jan2024Citi.csv") |>
  janitor::clean_names() |>
  mutate(time = "Jan 2024")
jul20 = read_csv("July2020Citi.csv") |>
  janitor::clean_names() |>
  mutate(time = "Jul 2020")
jul24 = read_csv("July2024Citi.csv") |>
  janitor::clean_names() |>
  mutate(time = "Jul 2024")
names(jul24)
names(jan24)
df_list <- list(jan20, jul20, jan24, jul24)
citi_merged <- df_list %>% 
  reduce(full_join, by = names(jan20))
citi_merged
table1 = citi_merged |>
  group_by(time, member_casual) |>
  summarize(total = n())
table1
table2 = jul24 |>
  group_by(start_station_name) |>
  summarize(total = n())
head(table2, 5) #to get the 5 most popular starting stations
plot_data = citi_merged |>
  separate(time, into = c("month", "year"), sep = " ") |>
  group_by(weekdays, month, year) |>
  summarize(median_duration = median(duration, na.rm = TRUE))
plot_data
ggplot(plot_data, aes(x = weekdays, y = median_duration, color = as.factor(year))) +
  geom_point() +
  facet_wrap(~ month) +
  labs(title = "Median Ride Duration by Day of the Week, Month, and Year",
       x = "Day of the Week",
       y = "Median Ride Duration (minutes)",
       color = "Year")
```


